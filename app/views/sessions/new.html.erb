<div class="h-screen flex flex-col items-center justify-center bg-gray-100 p-8">
  <h1 class="text-4xl font-bold text-[#FFD100] mb-12 uppercase tracking-wide bg-[#2C2C2C] px-6 py-2 rounded-lg shadow-lg">Kassorama Login</h1>
  
  <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 w-full max-w-5xl">
     <% @users.each do |user| %>
        <div onclick="promptPin(<%= user.id %>, '<%= user.name %>')" class="bg-white rounded-2xl shadow-xl hover:shadow-2xl cursor-pointer transform hover:scale-105 transition duration-300 p-8 flex flex-col items-center justify-center border-b-4 border-[#FFD100] group aspect-square">
            <div class="text-6xl font-black text-gray-800 mb-4 group-hover:text-[#FFD100] transition">
               <%= user.name.split.map(&:first).join.upcase %>
            </div>
            <div class="text-xl font-medium text-gray-500">
               <%= user.name %>
            </div>
        </div>
     <% end %>
  </div>
  
  <!-- Hidden form -->
  <%= form_with url: login_path, method: :post, id: "login_form", class: "hidden" do |form| %>
     <%= form.hidden_field :user_id, id: "login_user_id" %>
     <%= form.hidden_field :pin, id: "login_pin" %>
  <% end %>
  
  <!-- Simple PIN Modal (hidden by default) -->
  <div id="pin_modal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex min-h-screen items-center justify-center p-4 text-center sm:p-0">
      
      <!-- Backdrop -->
      <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true" onclick="closeModal()"></div>

      <!-- content -->
      <div class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-sm sm:p-6">
        <div class="flex flex-col items-center w-full px-2 sm:px-4">
             <h2 class="text-2xl font-bold mb-6 text-center text-gray-900" id="modal_user_name">Enter PIN</h2>
             
             <input type="password" id="pin_input" class="w-full max-w-xs text-center text-4xl tracking-[0.5em] font-bold border-b-4 border-gray-200 focus:border-[#FFD100] outline-none mb-8 pb-2 text-gray-800 placeholder-gray-300 bg-transparent" maxlength="6" autofocus placeholder="••••••">
             
             <div class="w-full max-w-[280px] flex flex-col gap-4">
                 <div class="flex gap-4 justify-center">
                     <% [7,8,9].each do |n| %>
                       <button type="button" onclick="appendPin('<%= n %>')" class="w-12 h-12 flex items-center justify-center bg-gray-50 hover:bg-gray-100 text-xl font-bold rounded-lg shadow-sm border border-gray-100 transition active:scale-95"><%= n %></button>
                     <% end %>
                 </div>
                 <div class="flex gap-4 justify-center">
                     <% [4,5,6].each do |n| %>
                       <button type="button" onclick="appendPin('<%= n %>')" class="w-12 h-12 flex items-center justify-center bg-gray-50 hover:bg-gray-100 text-xl font-bold rounded-lg shadow-sm border border-gray-100 transition active:scale-95"><%= n %></button>
                     <% end %>
                 </div>
                 <div class="flex gap-4 justify-center">
                     <% [1,2,3].each do |n| %>
                       <button type="button" onclick="appendPin('<%= n %>')" class="w-12 h-12 flex items-center justify-center bg-gray-50 hover:bg-gray-100 text-xl font-bold rounded-lg shadow-sm border border-gray-100 transition active:scale-95"><%= n %></button>
                     <% end %>
                 </div>
                 <div class="flex gap-4 justify-center">
                     <button type="button" onclick="clearPin()" class="w-12 h-12 flex items-center justify-center bg-red-50 hover:bg-red-100 text-red-600 font-bold rounded-lg shadow-sm border border-red-100 transition active:scale-95">C</button>
                     <button type="button" onclick="appendPin('0')" class="w-12 h-12 flex items-center justify-center bg-gray-50 hover:bg-gray-100 text-xl font-bold rounded-lg shadow-sm border border-gray-100 transition active:scale-95">0</button>
                     <button type="button" onclick="validatePin()" class="w-12 h-12 flex items-center justify-center bg-[#FFD100] hover:bg-yellow-400 text-black font-bold rounded-lg shadow-sm border border-yellow-500 transition active:scale-95">OK</button>
                 </div>
             </div>
             
             <div class="mt-6 text-center">
                 <button type="button" onclick="closeModal()" class="text-sm text-gray-500 hover:text-gray-700 underline">Cancel</button>
             </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  let currentUserId = null;

  function promptPin(userId, userName) {
      currentUserId = userId;
      document.getElementById('modal_user_name').textContent = "PIN for " + userName;
      document.getElementById('pin_modal').classList.remove('hidden');
      document.getElementById('pin_input').value = '';
      document.getElementById('pin_input').focus();
  }
  
  function closeModal() {
      document.getElementById('pin_modal').classList.add('hidden');
      currentUserId = null;
  }
  
  function appendPin(num) {
      const input = document.getElementById('pin_input');
      if(input.value.length < 6) {
          input.value += num;
      }
  }
  
  function clearPin() {
      document.getElementById('pin_input').value = '';
  }
  
  function validatePin() {
      const pin = document.getElementById('pin_input').value;
      if (pin.length > 0) {
          document.getElementById('login_user_id').value = currentUserId;
          document.getElementById('login_pin').value = pin;
          document.getElementById('login_form').submit();
      }
  }
  
  // Handle physical keyboard too
  document.getElementById('pin_input').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
          validatePin();
      }
  });
</script>
